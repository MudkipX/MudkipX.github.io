<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>74cms-v4.2.1-v4.2.129-后台getshell</title>
    <url>/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/</url>
    <content><![CDATA[<h2 id="0x00-漏洞原理"><a href="#0x00-漏洞原理" class="headerlink" title="0x00 漏洞原理"></a>0x00 漏洞原理</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">触发点：Application/Admin/Controller/TplController.class.php</span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/%E6%BC%8F%E6%B4%9E%E7%82%B9.png" alt="漏洞点"></p>
<p>这里利用TP的I函数接收了tpl_dir参数，看一下I函数具体实现过程</p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/I%E5%87%BD%E6%95%B0.png" alt="I函数"></p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/I%E5%87%BD%E6%95%B02.png" alt="I函数2"></p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/I%E5%87%BD%E6%95%B03.png" alt="I函数3"></p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/%E8%BF%87%E6%BB%A4%E5%87%BD%E6%95%B0.png" alt="过滤函数"></p>
<p>至此可以知道，这里I函数一共调用了htmlspecialchars,stripslashes,strip_tags,trim函数，咱们继续往下看。</p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/update_config.png" alt="update_config"></p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/update_config1.png" alt="update_config1"></p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/update_config2.png" alt="update_config2"></p>
<p>至此，这个漏洞有了完整的利用链，接下来看看如何利用漏洞。</p>
<h2 id="0x01-利用方法"><a href="#0x01-利用方法" class="headerlink" title="0x01 利用方法"></a>0x01 利用方法</h2><p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/%E5%88%A9%E7%94%A8.png" alt="利用"></p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/%E5%88%A9%E7%94%A81.png" alt="利用1"></p>
<p>访问config.php文件</p>
<p><img src="/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/%E5%88%A9%E7%94%A82.png" alt="利用2"></p>
<h2 id="0x02-下一步工作"><a href="#0x02-下一步工作" class="headerlink" title="0x02 下一步工作"></a>0x02 下一步工作</h2><p>74cms v4.2.3 任意文件删除</p>
]]></content>
      <categories>
        <category>74CMS系列</category>
      </categories>
      <tags>
        <tag>PHP代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>74cms-v4.2.3-任意文件删除</title>
    <url>/2021/12/12/74cms-v4-2-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/</url>
    <content><![CDATA[<h2 id="0x00-漏洞原理"><a href="#0x00-漏洞原理" class="headerlink" title="0x00 漏洞原理"></a>0x00 漏洞原理</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">触发点：Application/Admin/Controller/DatabaseController.class.php</span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/12/74cms-v4-2-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/%E8%A7%A6%E5%8F%91%E7%82%B9.png" alt="触发点"></p>
<p>经过上一章节<a href="https://blog.mudkipx.cn/2021/12/12/74cms-v4-2-1-v4-2-129-%E5%90%8E%E5%8F%B0getshell/">74cms-v4-2-1-v4-2-129-后台getshell</a>,我们知道这里的I函数主要用了这几个函数进行过滤：htmlspecialchars,stripslashes,strip_tags,trim</p>
<p><img src="/2021/12/12/74cms-v4-2-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/rmdirs.png" alt="rmdirs"></p>
<p>漏洞利用点找到了，接下来看看如何利用</p>
<h2 id="0x01-利用方法"><a href="#0x01-利用方法" class="headerlink" title="0x01 利用方法"></a>0x01 利用方法</h2><p><img src="/2021/12/12/74cms-v4-2-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/%E5%88%A9%E7%94%A8.png" alt="利用"></p>
<p><img src="/2021/12/12/74cms-v4-2-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/%E6%9C%AA%E6%89%A7%E8%A1%8C.png" alt="未执行"></p>
<p><img src="/2021/12/12/74cms-v4-2-3-%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/%E5%B7%B2%E6%89%A7%E8%A1%8C.png" alt="已执行"></p>
<p>在执行后，install文件夹被删除</p>
<h2 id="0x02-下一步工作"><a href="#0x02-下一步工作" class="headerlink" title="0x02 下一步工作"></a>0x02 下一步工作</h2><p>74cms v4.2.3 任意文件读取</p>
]]></content>
      <categories>
        <category>74CMS系列</category>
      </categories>
      <tags>
        <tag>PHP代码审计</tag>
      </tags>
  </entry>
  <entry>
    <title>笔者序</title>
    <url>/2021/12/11/%E7%AC%94%E8%80%85%E5%BA%8F/</url>
    <content><![CDATA[<h2 id="0x00-开篇"><a href="#0x00-开篇" class="headerlink" title="0x00 开篇"></a>0x00 开篇</h2><p>其实一直想找一个时间来好好的写点文字，但是由于工作繁忙一直没有动笔的机会和想法。正好最近工作量少了许多，闲暇之际，又萌生出了做一个博客的想法，那么这篇总结我人生前23年以及展望未来的文章就作为博客的序章吧，没有什么华丽的词藻，只是在普通的文字中回顾过往。</p>
<h2 id="0x01-回顾过往"><a href="#0x01-回顾过往" class="headerlink" title="0x01 回顾过往"></a>0x01 回顾过往</h2><p>1998年，我出生在浙江的一个普通的家庭，我的父亲是我们县城里的一名普通的公务员，我的母亲是一家医院的护士，我的家庭条件不算富裕，但也算得上是小康家庭，就这样我在这个家庭中无忧无虑的生活着。<br></p>
<h3 id="1-童年阶段"><a href="#1-童年阶段" class="headerlink" title="1.童年阶段"></a>1.童年阶段</h3><p>童年的记忆到现在我已是记得不太贴切了，只依稀记得我的家门口就是一条大河，有树，有花，有草坪，有我的一辆自行车还有那张破旧的躺椅。记得那时候的我，每天最开心的事情就是和邻居家的孩子一起比赛自行车，谁骑的快谁就获胜。我们的“赛道”就是家门口的小路，我们骑着自行车沿着河岸从一棵棵高大的树边出发，从一片片花朵边掠过，从高高的台阶上一跃而起，随后落下，再从一颗颗小草边穿过，最后抵达了终点。童年的我很容易满足，只是简单的一个自行车比赛，就能填补我一天的快乐生活。由于我父母职业的特殊性，经常会因为值班不回家，可以说我的童年除了我的父母，还有我的外婆。我的外婆是一名机床厂的退休职工，记得童年时的我每到夏天的晚上，就喜欢和外婆一起，躺在冰冰凉凉的躺椅上，看着天空中一眨一眨的小星星，听着大河潺潺的流水声，嗅着小草们散发出来的淡淡清香，享受着晚风轻轻吹拂在我的脸颊，缓缓睡去。那些年，那条河，那棵树，那朵花，那块草坪，那辆自行车和那张破旧的躺椅见证了我童年时期最美好的时光。<br></p>
<h3 id="2-小学阶段"><a href="#2-小学阶段" class="headerlink" title="2.小学阶段"></a>2.小学阶段</h3><p>到了7岁，我开始读小学了，我的小学班主任是一个付责任且美丽端庄的女老师，她有一手好书法，到现在每当她在朋友圈发一些书法的时候我都会好好的观摩一番，一边观摩一边后悔为什么没有练一手好书法。我的小学班主任十分关心我，不论是我的学科成绩还是我的生活，她如同家长一般关心着我的成长，我取得好成绩时，她会告诉我不要骄傲，要继续努力，我遇到挫折时，她会告诉我不要难受，奋勇向前，她对我的教育，可以说一直影响我到现在，我也相信在未来也会受益终身。小学时期的我，可能是受到了童年时期活泼好动的影响，我的体育成绩也是异常出色，班级里上体育课，短跑总是能拉同学一大截，跑到终点后还会对班上的女同学抛出胜利且骄傲的眼光，但是貌似女同学们并不太“感冒”，我也就悻悻的离开了，当然，我也被选入了校阳光运动队，代表学校参加比赛，也算是我小学生涯体育能力的一次肯定吧。记得小学的时候，是统一时间放学的，所以校门口会特别的乱，这个时候家长的眼睛是最忙碌的，而我的家长却能第一时间看到我，拿我母亲的话来说就是：放学的时候看谁最脏就行。没错，我差不多是学校里最脏的一个，那会儿学校的跑道不是现在的塑胶跑道，而是煤渣跑道，我作为学校里最活跃的其中一个，一下课就会去操场边“和泥”，我会把煤渣收集起来，推到操场边的某个角落，然后倒上自来水，用手不断的揉搓煤渣，使之成为一坨类似水泥一样的混合物，每天以此为乐。可能我的父母嫌我太闹腾，他们想通过一些“文艺”的手段试图改变我，在二年级的时候，他们给我报名了小提琴的培训班，我也有幸成为了为数不多会拉小提琴的小学生。因为小提琴是弦乐器，所以刚学习的时候，每个周末练完琴，手指肚上都会留下一条条印痕，导致我那会儿叫苦不迭，当然随着练习时长的增加，我也渐渐适应了这样的生活，功夫不负有心人，我也成功取得了小提琴业余八级的证书。就这样六年匆匆逝去，我开启了我的初中生活。<br></p>
<h3 id="3-初中阶段"><a href="#3-初中阶段" class="headerlink" title="3.初中阶段"></a>3.初中阶段</h3><p>到了13岁，我开始读初中，那会儿县城里有两家公办初中，其中一家是县城里最好的，一家较落后。而我小升初那一年刚好赶上了政策变化，通过摇号的方式选择去哪一家中学读书，幸运的是，我抽到了最好的那一所学校，我也就顺利的进入了初中阶段，初中阶段的我较小学阶段相对安静了许多，也不再去“和泥”。但是也惹了不少的事情。我的初中班主任一共有两位，原因是在读到初二的时候由于两家初中合并，所以又进行了分班。我的初中也因此有了两个阶段：”玩乐时期“和“学习时期”。我的“玩乐时期”主要是在初一，那时候，班级里我和其他两位男同学玩的最好，在当时“兄弟天下”的背景下，我们也顺利的组成了班级的“铁三角”，我们三人平日里形影不离，遇事也总喜欢“打抱不平”，班主任也对我们没有什么办法，在课堂上说话的有我们仨，在课堂上睡觉的也有我们仨，下课后最吵的人里也有我们仨，就这样整个初一阶段就是这么浑浑噩噩的度过的。等到了初二我们分完班之后的第一个学期，虽说当时的我没有像初一时候这么喜欢玩闹，但也谈不上喜欢学习，成绩也是在班级里排在中下游的水平，我的父母也为了我学习的事情急的焦头烂额。当然虽然我学习不积极，但是一些好玩的事情我当然不会错过，一个机缘巧合之下我成为了我们校管弦乐队的一份子，我也经常利用我的中午休息时间跑去练琴，我记得当时我们主要练了两首曲子:《山丹丹开花红艳艳》以及《渔舟唱晚》，我想也是在那个时候让我这颗浮躁的心慢慢的得到了沉淀。到了初二下学期，我的第二位班主任把分班后的第一批入团名额给了我，也是从那时起，我慢慢开始努力了起来，上课也不爱打瞌睡了，下课也看不到我到处玩乐的背影了，只能看到我不停写作业和写试卷的样子，那时候我的想法就是：既然老师这么信任我，我也不能辜负老师，况且这是为我自己以后能考上我们县最好的高中而努力。自此以后我的成绩如同火箭一般一路上窜，到初三下学期，我的成绩也可以稳定在全班前15的成绩，要知道那时候平均一个班大约有20个不到的学生可以去最好的高中，也就是说我的成绩处在了一个可进可退的位置，在我的班主任及任课老师的努力下，终于考上了我们县里最好的高中，开启了我的高中生活。<br></p>
<h3 id="5-高中阶段"><a href="#5-高中阶段" class="headerlink" title="5.高中阶段"></a>5.高中阶段</h3><p>从班级倒数到考入县城最好的高中，这是我第一次另别人刮目相看的时候，其实很多时候人离成功往往缺少的不是机会，而是不断尝试，不断突破自己极限的勇气。当你顺利攀上一座高峰的时候，你会发现，原来曾经拼搏过的道路很美，当然这个时候也不能骄傲自满，需要继续整理行囊，去攀另一座高峰。高中三年，是我成长最为迅速的三年，因为在我的人生中遇到了一位足以改变我的一生命运的老师，那就是我们高中班主任，是他倾力奉献的职业精神，也是他以身作则的人格品质教会了我许多为人处事的道理以及不断追求完美的工作态度，当然我也在我的高中遇到了我一生中的挚友，良师与挚友对我的影响，使我更容易向上攀峰。每当我仔细回想高中生活，总会唏嘘不已，似乎还在眼前，但又与我渐行渐远。令我记忆犹新的高中的故事有太多太多，我无法在博客序章中一一写出，只能记录一些使我成长的故事。高中这三年我学会了团结和拼搏，记得高一下学期要面临分班的抉择，当时我们高中采取的是拆开四个成绩最差的班级，经历了一年的相处，没有一个班级愿意被拆开，是否能保留班级，让班主任继续带领我们，就取决于大一下学期的期末测试成绩，但是当时我们班成绩一直不稳定，排名经常处于倒数的位置，学校领导和老师都觉得我们的班级会被拆开，但是我们班的同学都没有放弃，继续顽强的拼搏，成绩好的希望自己能再多进几名，成绩差希望自己不要拉班级的后腿，就这样同学们通宵达旦的学习，最后成绩排名第二，成功保住了班级，当结果出来的那一刻，同学们的脸上都洋溢出了开心的笑容，那一刻我明白了，原来团结和拼搏真的可以让一个团队迸发出难以想象的力量。高中这三年我学会了要时刻保持着一颗不断追求完美的工作态度，生活中的班主任和我们打成一片，和我们称兄道弟，体育课上一起踢足球，运动会上一起为运动员呐喊助威，但是在工作上，他却有着一丝不苟的工作态度，他希望他的工作是很完美的，他会把每一件小事都做到精益求精，他同时也会要求我们把每一件事都做到几近完美，我就亲身经历过一回，还记得那时候班级的后面总会有两个球，男生们下课就喜欢摸摸球，有一回因为我的一个失误操作将摆放在教室后方的大花盆摔坏，班主任让我买一个新的过来赔偿，第二天，我扛着新花盆来到了学校，并随手将花盆放在了教师后方，班主任进来之后看到这个场景没有多说什么，当天中午他就开着车将花盆带去了花店，将花移好后装满土运了回来，事后我才得知在途中还不小心碰到了路过的行人，那一刻我自惭形秽，也是在那一刻，我懂得了一件工作、一件事，你做了就必须要将工作做到极致和完美，不能有一丝一毫的偏差，这才是我们应该追求的工作态度。感谢我的高中，感谢我的班主任，感谢我的同学们。<br></p>
<h3 id="6-大学阶段"><a href="#6-大学阶段" class="headerlink" title="6.大学阶段"></a>6.大学阶段</h3><p>时光到了2016年，转眼间我上了大学，一所还不算特别差的学校，虽然不够211，985的名气，但是毕业后的前景还是很好的。当我迈进大学教室的第一步，我就在思考我的大学生涯应该如何去度过，当时的我告诉自己：不能再像初中、高中这样了，你要好好的学习，才能实现你的人生价值。大一第一堂课，老师介绍了我们这个专业以及优秀的学长学姐，那一刻我第一次知道了原来大学的生活也能过的如此不平凡。在一次CTF比赛中，我有幸认识到了我的两位优秀学长兼出题人berTrAM和GoldsNow，当然现在已经和他们称兄道弟了。在当时这两位优秀学长一直是我们专业的骄傲，说不羡慕是假的，我很希望能够有一天追赶上他们俩的步伐，一直到现在还在不断的追逐着。之后的几年，两位学长带我参加了许多国家级的取证比赛，并且取得了不错的成绩，应该说他们是我专业路上的引路人，没有他们的引领，可能我永远不会踏上信息安全这条路，再此特地感谢我的两位引路人。另外有两位老师也是我非常尊敬的，是他们给了我很多机会，让我继续在信息安全、电子取证的路上越走越远。<br></p>
<h3 id="7-工作"><a href="#7-工作" class="headerlink" title="7.工作"></a>7.工作</h3><p>2020年11月，我第一次正式的参加工作，到现在差不多一年多的时间，在这一年多的时间里，我又一次遇到了我人生中的良师与益友。我的师傅是一个优秀的行业人才，他创造了很多先例。他是我到目前为止最为崇拜的人，在和他学习的一年多的时间里，他也教会了我许多不曾在学校里教过的知识，他有着严谨的工作作风和雷厉风行的工作态度以及过硬的技术本领，一直是促进我不断学习的目标。<br></p>
<h2 id="0x02-关于我的博客"><a href="#0x02-关于我的博客" class="headerlink" title="0x02 关于我的博客"></a>0x02 关于我的博客</h2><p>努力将博客打造成高质量、高水平的技术博客。回顾已爆出的WEB漏洞，以代码审计的方式更准确的理解漏洞的成因、结果以及利用方法。</p>
]]></content>
      <categories>
        <category>随笔</category>
      </categories>
      <tags>
        <tag>随笔</tag>
      </tags>
  </entry>
</search>
